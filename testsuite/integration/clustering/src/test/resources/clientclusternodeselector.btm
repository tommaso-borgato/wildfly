#
# tracks the affinity provided to EJB Client Interceptors
#
RULE @Trace Any EJBClientInterceptor
INTERFACE ^org.jboss.ejb.client.EJBClientInterceptor
METHOD handleInvocation
AT EXIT
IF TRUE
DO
  org.jboss.as.test.clustering.cluster.ejb.remote.ClientClusterNodeSelectorTestCase.AFFINITY = $context.getLocator().getAffinity().toString();
ENDRULE

#
# tracks the cluster name returned by the server to the client: cluster name is used to set affinity
#
RULE @Trace Any ClusterAffinity
CLASS org.jboss.ejb.client.ClusterAffinity
METHOD <init>(String)
AT ENTRY
IF TRUE
DO
  org.jboss.as.test.clustering.cluster.ejb.remote.ClientClusterNodeSelectorTestCase.CLUSTER_NAME = $1;
ENDRULE